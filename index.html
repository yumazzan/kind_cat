<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KIND CAT - BL Interactive Fiction</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif; background: #1A1A1A; min-height: 100vh; color: #FFFFFF; overflow-x: hidden; }
        .app-container { max-width: 100%; margin: 0 auto; padding: 0; }
        .header { background: #2D3436; padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 2px solid #C9395A; position: sticky; top: 0; z-index: 100; }
        .logo { display: flex; align-items: center; gap: 12px; }
        .cat-icon { width: 36px; height: 36px; background: linear-gradient(135deg, #FFB3D9 0%, #B794F6 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.3em; }
        .brand-name { font-size: 1.3em; font-weight: bold; letter-spacing: 2px; font-family: 'Courier New', monospace; }
        .menu-btn { width: 40px; height: 40px; background: transparent; border: 2px solid #C9395A; border-radius: 8px; color: #C9395A; font-size: 1.2em; cursor: pointer; transition: all 0.3s ease; display: none; }
        .menu-btn:hover { background: #C9395A; color: white; }
        .main-content { display: grid; grid-template-columns: 320px 1fr; height: calc(100vh - 80px); position: relative; }
        .sidebar { background: #2D3436; border-right: 1px solid #3D4446; overflow-y: auto; transition: transform 0.3s ease; }
        .sidebar.mobile-hidden { transform: translateX(-100%); }
        .sidebar-section { padding: 20px; border-bottom: 1px solid #3D4446; }
        .section-title { font-size: 0.9em; color: #C9395A; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; font-weight: bold; }
        .character-card { background: linear-gradient(135deg, #C9395A 0%, #7D1E3A 100%); padding: 15px; border-radius: 12px; margin-bottom: 12px; }
        .character-card h3 { font-size: 1.1em; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .character-card p { font-size: 0.85em; line-height: 1.5; margin: 4px 0; opacity: 0.95; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .stat-item { background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; text-align: center; }
        .stat-label { font-size: 0.75em; opacity: 0.8; margin-bottom: 5px; }
        .stat-value { font-size: 1.2em; font-weight: bold; color: #FFB3D9; }
        .affection-meter { margin-top: 15px; }
        .affection-bar { background: rgba(0,0,0,0.3); height: 30px; border-radius: 15px; overflow: hidden; position: relative; margin-top: 8px; }
        .affection-fill { background: linear-gradient(90deg, #E8749B, #FFB3D9); height: 100%; transition: width 0.5s ease; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.9em; min-width: 50px; }
        .chat-area { display: flex; flex-direction: column; background: #1A1A1A; }
        .chat-header { background: #2D3436; padding: 15px 25px; border-bottom: 1px solid #3D4446; }
        .chat-title { font-size: 1.2em; font-weight: bold; margin-bottom: 5px; }
        .scene-info { font-size: 0.85em; opacity: 0.7; }
        .messages-container { flex: 1; overflow-y: auto; padding: 20px; }
        .message-bubble { margin-bottom: 20px; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .bubble-wrapper { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 8px; }
        .bubble-wrapper.user { flex-direction: row-reverse; }
        .avatar { width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(135deg, #FFB3D9 0%, #B794F6 100%); display: flex; align-items: center; justify-content: center; font-size: 1.2em; flex-shrink: 0; }
        .message-content { max-width: 70%; padding: 15px 20px; border-radius: 20px; line-height: 1.7; white-space: pre-wrap; word-break: keep-all; }
        .message-bubble.system .message-content { background: #2D3436; color: #FFFFFF; max-width: 100%; text-align: center; font-size: 0.9em; border: 1px solid #3D4446; }
        .message-bubble.story .message-content { background: #3D4446; color: #FFFFFF; border-left: 3px solid #C9395A; max-width: 85%; }
        .message-bubble.user .message-content { background: #C9395A; color: #FFFFFF; border-radius: 20px 20px 4px 20px; }
        .message-meta { font-size: 0.75em; opacity: 0.6; margin-left: 15px; margin-bottom: 5px; }
        .choice-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; max-width: 85%; }
        .choice-btn { padding: 12px 18px; background: rgba(201, 57, 90, 0.2); border: 2px solid #C9395A; border-radius: 12px; color: #FFFFFF; font-size: 0.95em; cursor: pointer; transition: all 0.3s ease; text-align: left; }
        .choice-btn:hover { background: #C9395A; transform: translateX(5px); }
        .choice-btn:disabled { opacity: 0.3; cursor: not-allowed; transform: none; }
        .input-area { padding: 20px; background: #2D3436; border-top: 1px solid #3D4446; }
        .input-wrapper { display: flex; gap: 12px; align-items: center; }
        .input-field { flex: 1; background: #1A1A1A; border: 2px solid #3D4446; color: #FFFFFF; padding: 14px 18px; border-radius: 25px; font-size: 1em; font-family: inherit; }
        .input-field:focus { outline: none; border-color: #C9395A; }
        .input-field::placeholder { color: #6C7A7D; }
        .send-btn { width: 50px; height: 50px; background: #C9395A; border: none; border-radius: 50%; color: white; font-size: 1.2em; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .send-btn:hover { background: #7D1E3A; transform: scale(1.1); }
        .send-btn:disabled { opacity: 0.3; cursor: not-allowed; transform: none; }
        .loading-indicator { text-align: center; padding: 20px; color: #6C7A7D; font-style: italic; }
        .loading-indicator::after { content: '...'; animation: dots 1.5s steps(4, end) infinite; }
        @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60%, 100% { content: '...'; } }
        .start-screen { display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; }
        .start-container { background: #2D3436; border-radius: 20px; padding: 40px; max-width: 500px; width: 100%; text-align: center; border: 2px solid #C9395A; }
        .start-logo { width: 100px; height: 100px; margin: 0 auto 25px; background: linear-gradient(135deg, #FFB3D9 0%, #B794F6 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3em; }
        .start-title { font-size: 1.8em; margin-bottom: 10px; font-family: 'Courier New', monospace; letter-spacing: 3px; }
        .start-subtitle { color: #C9395A; margin-bottom: 25px; font-size: 1em; }
        .api-input { width: 100%; background: #1A1A1A; border: 2px solid #3D4446; color: #FFFFFF; padding: 15px; border-radius: 12px; font-size: 1em; margin-bottom: 20px; }
        .api-input:focus { outline: none; border-color: #C9395A; }
        .start-btn { width: 100%; padding: 16px; background: linear-gradient(135deg, #C9395A 0%, #7D1E3A 100%); border: none; border-radius: 12px; color: white; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: all 0.3s ease; }
        .start-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(201, 57, 90, 0.3); }
        .api-help { margin-top: 20px; font-size: 0.85em; color: #6C7A7D; line-height: 1.6; }
        .api-help a { color: #E8749B; text-decoration: none; }
        .api-help a:hover { text-decoration: underline; }
        .gallery-section { padding: 20px; border-top: 1px solid #3D4446; }
        .gallery-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-top: 15px; }
        .image-slot { aspect-ratio: 1; border-radius: 10px; overflow: hidden; position: relative; background: #1A1A1A; border: 2px solid #3D4446; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; }
        .image-slot:hover { transform: scale(1.05); }
        .image-slot.locked { opacity: 0.5; }
        .image-slot.unlocked { border-color: #C9395A; box-shadow: 0 0 20px rgba(201, 57, 90, 0.3); }
        .image-slot img { width: 100%; height: 100%; object-fit: cover; }
        .lock-icon { font-size: 1.5em; margin-bottom: 5px; }
        .unlock-text { font-size: 0.7em; color: #6C7A7D; text-align: center; padding: 0 5px; }
        .error-message { background: rgba(201, 57, 90, 0.2); border: 1px solid #C9395A; color: #FFB3D9; padding: 15px; border-radius: 10px; margin: 20px; text-align: center; line-height: 1.6; }
        @media (max-width: 1024px) {
            .menu-btn { display: block; }
            .main-content { grid-template-columns: 1fr; }
            .sidebar { position: fixed; top: 61px; left: 0; width: 280px; height: calc(100vh - 61px); z-index: 90; box-shadow: 2px 0 10px rgba(0,0,0,0.5); }
            .sidebar.mobile-hidden { transform: translateX(-100%); }
            .chat-area { height: calc(100vh - 61px); }
            .message-content { max-width: 85%; }
            .choice-grid { grid-template-columns: 1fr; max-width: 100%; }
            .gallery-grid { grid-template-columns: repeat(3, 1fr); }
        }
        @media (max-width: 480px) {
            .messages-container { padding: 15px; }
            .input-area { padding: 15px; }
            .gallery-grid { grid-template-columns: repeat(2, 1fr); }
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1A1A1A; }
        ::-webkit-scrollbar-thumb { background: #C9395A; border-radius: 4px; }
        .overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 80; }
        .overlay.active { display: block; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const IMAGE_CONFIG = {
            images: [
                { id: 1, threshold: 20, name: "Ï≤´ ÎßåÎÇ®", url: "https://via.placeholder.com/400x400/C9395A/FFFFFF?text=Image+1" },
                { id: 2, threshold: 40, name: "ÏπúÎ∞ÄÌï¥Ïßê", url: "https://via.placeholder.com/400x400/E8749B/FFFFFF?text=Image+2" },
                { id: 3, threshold: 60, name: "ÏÑ§Î†àÎäî ÏàúÍ∞Ñ", url: "https://via.placeholder.com/400x400/FFB3D9/FFFFFF?text=Image+3" },
                { id: 4, threshold: 80, name: "ÍπäÏñ¥ÏßÄÎäî Í¥ÄÍ≥Ñ", url: "https://via.placeholder.com/400x400/7D1E3A/FFFFFF?text=Image+4" },
                { id: 5, threshold: 100, name: "ÏôÑÏ†ÑÌïú Ïã†Î¢∞", url: "https://via.placeholder.com/400x400/B794F6/FFFFFF?text=Image+5" }
            ]
        };

        const SAMPLE_CHARACTERS = {
            characterA: { name: "Í∞ïÌÉúÌòÑ", age: 28, role: "Í≥µ", personality: "ÎÉâÌòàÍ≥µ", occupation: "ÎåÄÍ∏∞ÏóÖ Ïù¥ÏÇ¨", emoji: "üî∫" },
            characterB: { name: "Ïù¥Ï§ÄÏÑú", age: 24, role: "Ïàò", personality: "Í∞ïÏàò", occupation: "Ïã†ÏûÖ ÏÇ¨Ïõê", emoji: "üîª" }
        };

        const INITIAL_SCENE = { time: "11Ïõî 15Ïùº Í∏àÏöîÏùº 19:30", location: "ÌöåÏÇ¨ - ÎåÄÌëúÏù¥ÏÇ¨Ïã§" };

        function KindCatApp() {
            const [apiKey, setApiKey] = useState("");
            const [started, setStarted] = useState(false);
            const [loading, setLoading] = useState(false);
            const [messages, setMessages] = useState([]);
            const [userInput, setUserInput] = useState("");
            const [affectionScore, setAffectionScore] = useState(0);
            const [excitementLevel, setExcitementLevel] = useState(0);
            const [turnCount, setTurnCount] = useState(0);
            const [unlockedImages, setUnlockedImages] = useState([]);
            const [sidebarOpen, setSidebarOpen] = useState(true);
            const messagesEndRef = useRef(null);

            useEffect(() => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            }, [messages]);

            useEffect(() => {
                const newUnlocks = [];
                IMAGE_CONFIG.images.forEach(img => {
                    if (affectionScore >= img.threshold && !unlockedImages.includes(img.id)) {
                        newUnlocks.push(img.id);
                    }
                });
                
                if (newUnlocks.length > 0) {
                    setUnlockedImages([...unlockedImages, ...newUnlocks]);
                    const unlockedImg = IMAGE_CONFIG.images.find(img => newUnlocks.includes(img.id));
                    if (unlockedImg) {
                        setMessages(prev => [...prev, {
                            type: "system",
                            content: `üéâ ÏÉàÎ°úÏö¥ ÏùºÎü¨Ïä§Ìä∏ Ìï¥Í∏à!\n"${unlockedImg.name}" (Ìò∏Í∞êÎèÑ ${unlockedImg.threshold}Ï†ê)`
                        }]);
                    }
                }
            }, [affectionScore]);

            const startStory = () => {
                if (!apiKey.trim()) {
                    alert("Gemini API ÌÇ§Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!");
                    return;
                }
                setStarted(true);
                initializeStory();
            };

            const initializeStory = async () => {
                setMessages([{
                    type: "system",
                    content: `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚è∞ ${INITIAL_SCENE.time}
üìç ${INITIAL_SCENE.location}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üî∫ ${SAMPLE_CHARACTERS.characterA.name} (${SAMPLE_CHARACTERS.characterA.age}ÏÑ∏)
   ‚ñ´Ô∏è ÏÉÅÌÉú: Ï±ÖÏÉÅÏóê ÏïâÏïÑ ÏÑúÎ•òÎ•º Í≤ÄÌÜ† Ï§ë
   ‚ñ´Ô∏è Î≥µÏû•: Ï†ïÏû• ÏÉÅÏùòÎäî Î≤óÍ≥† ÏÖîÏ∏†Îßå ÏûÖÏùÄ ÏÉÅÌÉú

üîª ${SAMPLE_CHARACTERS.characterB.name} (${SAMPLE_CHARACTERS.characterB.age}ÏÑ∏)
   ‚ñ´Ô∏è ÏÉÅÌÉú: Î¨∏ ÏïûÏóê ÏÑúÏÑú Î≥¥Í≥†ÏÑúÎ•º Îì§Í≥† ÏûàÏùå
   ‚ñ´Ô∏è Î≥µÏû•: Îã®Ï†ïÌïú ÏÖîÏ∏†ÏôÄ Ïä¨ÎûôÏä§
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`
                }]);
                await generateAIResponse("Ïä§ÌÜ†Î¶¨Î•º ÏãúÏûëÌï¥Ï£ºÏÑ∏Ïöî.");
            };

            const generateAIResponse = async (userMessage) => {
                setLoading(true);

                try {
                    const prompt = `ÎãπÏã†ÏùÄ ÌïúÍµ≠ BL Ïû•Î•¥Ïùò ÏûëÍ∞ÄÏûÖÎãàÎã§.
Ï∫êÎ¶≠ÌÑ∞: ${SAMPLE_CHARACTERS.characterA.name}(Í≥µ, ${SAMPLE_CHARACTERS.characterA.personality}), ${SAMPLE_CHARACTERS.characterB.name}(Ïàò, ${SAMPLE_CHARACTERS.characterB.personality})
ÌòÑÏû¨: Ìò∏Í∞êÎèÑ ${affectionScore}/100, Ìù•Î∂ÑÎèÑ ${excitementLevel}%, ÌÑ¥ ${turnCount}
ÏãúÏ†ê: ${SAMPLE_CHARACTERS.characterB.name} 1Ïù∏Ïπ≠
Í∑úÏπô: Í∞êÏ†ïÏùÑ Ïã†Ï≤¥ Î∞òÏùëÏúºÎ°ú ÌëúÌòÑ, 300-500Ïûê

ÏÇ¨Ïö©Ïûê ÌñâÎèô: ${userMessage}

JSON ÌòïÏãùÏúºÎ°úÎßå ÏùëÎãµ:
{"narrative": "ÏÑúÏà†", "affection_change": 0, "excitement_change": 0, "choices": ["ÏÑ†ÌÉù1", "ÏÑ†ÌÉù2", "ÏÑ†ÌÉù3", "ÏÑ†ÌÉù4"]}`;

                    // ‚≠ê gemini-1.5-flash ÏÇ¨Ïö© (Îçî ÎÑâÎÑâÌïú Î¨¥Î£å Ìï†ÎãπÎüâ)
                    const response = await fetch(
                        `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`,
                        {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{
                                    parts: [{ text: prompt }]
                                }]
                            })
                        }
                    );

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(errorData.error?.message || `HTTP ${response.status}`);
                    }

                    const data = await response.json();
                    
                    if (!data.candidates?.[0]) {
                        throw new Error("AI ÏùëÎãµÏù¥ ÎπÑÏñ¥ÏûàÏäµÎãàÎã§.");
                    }

                    let text = data.candidates[0].content.parts[0].text;
                    let result;

                    try {
                        text = text.replace(/```json\n?/g, '').replace(/```\n?/g, '');
                        const jsonMatch = text.match(/\{[\s\S]*\}/);
                        
                        result = jsonMatch ? JSON.parse(jsonMatch[0]) : {
                            narrative: text,
                            affection_change: Math.floor(Math.random() * 5),
                            excitement_change: Math.floor(Math.random() * 5),
                            choices: ["Ï†ÅÍ∑πÏ†ÅÏúºÎ°ú Îã§Í∞ÄÍ∞ÄÍ∏∞", "Ï°∞Ïã¨Ïä§ÎüΩÍ≤å Îßê Í±∏Í∏∞", "ÏÉÅÌô©ÏùÑ ÏßÄÏºúÎ≥¥Í∏∞", "ÏûêÎ¶¨Î•º ÌîºÌïòÍ∏∞"]
                        };
                    } catch (e) {
                        result = {
                            narrative: text.substring(0, 500),
                            affection_change: 0,
                            excitement_change: 0,
                            choices: ["Í≥ÑÏÜçÌïòÍ∏∞"]
                        };
                    }

                    setAffectionScore(prev => Math.max(0, Math.min(100, prev + (result.affection_change || 0))));
                    setExcitementLevel(prev => Math.max(0, Math.min(100, prev + (result.excitement_change || 0))));
                    setTurnCount(prev => prev + 1);

                    setMessages(prev => [...prev, {
                        type: "story",
                        content: result.narrative,
                        choices: result.choices || []
                    }]);

                } catch (error) {
                    console.error("API Error:", error);
                    alert(`‚ùå API Ïò§Î•ò\n\n${error.message}\n\nüîß Ìï¥Í≤∞ Î∞©Î≤ï:\n1. API ÌÇ§ ÌôïÏù∏ (AIzaÎ°ú ÏãúÏûë)\n2. https://aistudio.google.com ÏóêÏÑú ÌÇ§ Ïû¨Î∞úÍ∏â\n3. Gemini API ÌôúÏÑ±Ìôî ÌôïÏù∏`);
                    setMessages(prev => [...prev, { type: "error", content: `‚ö†Ô∏è ${error.message}` }]);
                } finally {
                    setLoading(false);
                }
            };

            const handleChoiceClick = async (choice) => {
                setMessages(prev => [...prev, { type: "user", content: choice }]);
                await generateAIResponse(choice);
            };

            const handleSendMessage = async (e) => {
                e.preventDefault();
                if (!userInput.trim() || loading) return;
                const message = userInput;
                setUserInput("");
                setMessages(prev => [...prev, { type: "user", content: message }]);
                await generateAIResponse(message);
            };

            if (!started) {
                return (
                    <div className="start-screen">
                        <div className="start-container">
                            <div className="start-logo">üê±</div>
                            <h1 className="start-title">KIND CAT</h1>
                            <p className="start-subtitle">BL Interactive Fiction</p>
                            <input
                                type="password"
                                className="api-input"
                                placeholder="Gemini API ÌÇ§ (AIza...)"
                                value={apiKey}
                                onChange={(e) => setApiKey(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && startStory()}
                            />
                            <button className="start-btn" onClick={startStory}>Ïä§ÌÜ†Î¶¨ ÏãúÏûëÌïòÍ∏∞</button>
                            <div className="api-help">
                                <strong>üîë API ÌÇ§ Î∞úÍ∏â:</strong><br/>
                                <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a>ÏóêÏÑú Î¨¥Î£å Î∞úÍ∏â<br/>
                                <small>(gemini-2.0-flash Î™®Îç∏ ÏÇ¨Ïö©)</small>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="app-container">
                    <div className="header">
                        <div className="logo">
                            <div className="cat-icon">üê±</div>
                            <div className="brand-name">KIND CAT</div>
                        </div>
                        <button className="menu-btn" onClick={() => setSidebarOpen(!sidebarOpen)}>‚ò∞</button>
                    </div>
                    <div className={`overlay ${sidebarOpen ? '' : 'active'}`} onClick={() => setSidebarOpen(!sidebarOpen)} />
                    <div className="main-content">
                        <div className={`sidebar ${sidebarOpen ? '' : 'mobile-hidden'}`}>
                            <div className="sidebar-section">
                                <div className="section-title">Characters</div>
                                <div className="character-card">
                                    <h3>{SAMPLE_CHARACTERS.characterA.emoji} {SAMPLE_CHARACTERS.characterA.name}</h3>
                                    <p>{SAMPLE_CHARACTERS.characterA.age}ÏÑ∏ ¬∑ {SAMPLE_CHARACTERS.characterA.role}</p>
                                    <p>{SAMPLE_CHARACTERS.characterA.personality}</p>
                                    <p>{SAMPLE_CHARACTERS.characterA.occupation}</p>
                                </div>
                                <div className="character-card" style={{background: 'linear-gradient(135deg, #E8749B 0%, #7D1E3A 100%)'}}>
                                    <h3>{SAMPLE_CHARACTERS.characterB.emoji} {SAMPLE_CHARACTERS.characterB.name}</h3>
                                    <p>{SAMPLE_CHARACTERS.characterB.age}ÏÑ∏ ¬∑ {SAMPLE_CHARACTERS.characterB.role}</p>
                                    <p>{SAMPLE_CHARACTERS.characterB.personality}</p>
                                    <p>{SAMPLE_CHARACTERS.characterB.occupation}</p>
                                </div>
                            </div>
                            <div className="sidebar-section">
                                <div className="section-title">Story Status</div>
                                <div className="stats-grid">
                                    <div className="stat-item">
                                        <div className="stat-label">ÏßÑÌñâ ÌÑ¥</div>
                                        <div className="stat-value">{turnCount}</div>
                                    </div>
                                    <div className="stat-item">
                                        <div className="stat-label">Ìù•Î∂ÑÎèÑ</div>
                                        <div className="stat-value">{excitementLevel}%</div>
                                    </div>
                                </div>
                                <div className="affection-meter">
                                    <div className="stat-label">Í¥ÄÍ≥Ñ Ï†êÏàò</div>
                                    <div className="affection-bar">
                                        <div className="affection-fill" style={{width: `${Math.max(affectionScore, 10)}%`}}>
                                            {affectionScore}/100
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div className="sidebar-section gallery-section">
                                <div className="section-title">Gallery ({unlockedImages.length}/{IMAGE_CONFIG.images.length})</div>
                                <div className="gallery-grid">
                                    {IMAGE_CONFIG.images.map(img => {
                                        const isUnlocked = unlockedImages.includes(img.id);
                                        return (
                                            <div key={img.id} className={`image-slot ${isUnlocked ? 'unlocked' : 'locked'}`}>
                                                {isUnlocked && img.url ? (
                                                    <img src={img.url} alt={img.name} />
                                                ) : (
                                                    <>
                                                        <div className="lock-icon">üîí</div>
                                                        <div className="unlock-text">{img.threshold}Ï†ê</div>
                                                    </>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                        <div className="chat-area">
                            <div className="chat-header">
                                <div className="chat-title">{SAMPLE_CHARACTERS.characterA.name} √ó {SAMPLE_CHARACTERS.characterB.name}</div>
                                <div className="scene-info">{INITIAL_SCENE.location}</div>
                            </div>
                            <div className="messages-container">
                                {messages.map((msg, idx) => (
                                    <div key={idx} className={`message-bubble ${msg.type}`}>
                                        {msg.type === "system" && <div className="message-content">{msg.content}</div>}
                                        {msg.type === "story" && (
                                            <>
                                                <div className="message-meta">üìñ Ïä§ÌÜ†Î¶¨</div>
                                                <div className="bubble-wrapper">
                                                    <div className="avatar">üìñ</div>
                                                    <div style={{flex: 1}}>
                                                        <div className="message-content">{msg.content}</div>
                                                        {msg.choices?.length > 0 && (
                                                            <div className="choice-grid">
                                                                {msg.choices.map((choice, i) => (
                                                                    <button key={i} className="choice-btn" onClick={() => handleChoiceClick(choice)} disabled={loading}>
                                                                        ‚Üí {choice}
                                                                    </button>
                                                                ))}
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </>
                                        )}
                                        {msg.type === "user" && (
                                            <>
                                                <div className="message-meta" style={{textAlign: 'right', marginRight: '15px'}}>üë§ ÎãπÏã†Ïùò ÌñâÎèô</div>
                                                <div className="bubble-wrapper user">
                                                    <div className="avatar">üë§</div>
                                                    <div className="message-content">{msg.content}</div>
                                                </div>
                                            </>
                                        )}
                                        {msg.type === "error" && <div className="error-message">{msg.content}</div>}
                                    </div>
                                ))}
                                {loading && <div className="loading-indicator">Ïä§ÌÜ†Î¶¨Î•º ÏÉùÏÑ±ÌïòÎäî Ï§ëÏûÖÎãàÎã§</div>}
                                <div ref={messagesEndRef} />
                            </div>
                            <div className="input-area">
                                <form onSubmit={handleSendMessage}>
                                    <div className="input-wrapper">
                                        <input type="text" className="input-field" placeholder='Îã§Ïùå "ÎåÄÏÇ¨"ÏôÄ "ÌñâÎèô"ÏùÑ ÏûÖÎ†• ÌïòÏÑ∏Ïöî' value={userInput} onChange={(e) => setUserInput(e.target.value)} disabled={loading} />
                                        <button type="submit" className="send-btn" disabled={loading || !userInput.trim()}>‚ñ∂</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<KindCatApp />, document.getElementById('root'));
    </script>
</body>
</html>
